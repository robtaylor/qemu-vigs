#!/bin/sh -e

## User Define for desktop menu
currentPath=`pwd`
desktoppath=~/.local/share/applications

UBUNTU_VER=`awk 'BEGIN {FS="="}; /DISTRIB_RELEASE.*/ {print $2}' /etc/lsb-release`
case ${UBUNTU_VER} in
	11.04)
		categories="Tizen SDK;Development"
		;;
	11.10)
		categories="Tizen SDK;Development"
		;;
	*)
		categories="Tizen SDK"
		;;
esac



## vtm shortcut
vtm_desktopfile=$desktoppath/tizen-sdk-vtm.desktop
vtm_iconfile=vtm.ico
vtm_exefile=Emulator/vtm
vtm_comment="Virtual target manager is a tool which can make a cloned emulator image"
vtm_name="Virtual Target Manager"

## Do not modify the followings (Make desktop menu)
TIZEN_SDK_INSTALL_PATH=`echo $INSTALLED_PATH`
if [ -z $TIZEN_SDK_INSTALL_PATH ]
then
#   echo "There is no TIZEN_SDK_PATH ENV" >> /tmp/emulator.log
   exit 2;
fi

iconpath=~/.local/share/icons

vtm_exepath=$TIZEN_SDK_INSTALL_PATH/$vtm_exefile

mkdir -p $iconpath

if test -e $TIZEN_SDK_INSTALL_PATH/temp/$vtm_iconfile 
then 
	cp -f $TIZEN_SDK_INSTALL_PATH/temp/$vtm_iconfile $iconpath/$vtm_iconfile
else
	echo "$vtm_iconfile does not exist!!"
	exit 1
fi

#cp -f $TIZEN_SDK_INSTALL_PATH/temp/$vtm_iconfile $iconpath/$vtm_iconfile

mkdir -p $desktoppath

## Create vtm .desktop file 
cat > $vtm_desktopfile << END
[Desktop Entry]
Encoding=UTF-8
Value=1.0
Type=Application
Terminal=false
Comment=$vtm_comment
Name=$vtm_name
Categories=$categories
StartupNotify=true
NoDisplay=false
END

cat >> $vtm_desktopfile << END
Icon=$iconpath/$vtm_iconfile
Exec=$vtm_exepath
END

## Register .desktop file
xdg-desktop-menu install $MENU_DIRECTORY $vtm_desktopfile
### END Register Menu ###
