#!/bin/sh -e

## User Define for desktop menu
currentPath=`pwd`
desktoppath=~/.local/share/applications
categories="Samsung Linux Platform"

## emulator shortcut 
emul_desktopfile=$desktoppath/samsung-sdk-emulator.desktop
emul_iconfile=emulator.png
emul_exefile=Emulator/emulator
emul_comment="Emulator running software on a Samsung Phone"
emul_name="SLP Emulator"

## vtm shortcut
vtm_desktopfile=$desktoppath/samsung-sdk-vtm.desktop
vtm_iconfile=vtm.png
vtm_exefile=Emulator/vtm
vtm_comment="Virtual target manager is a tool which can make a cloned emulator image"
vtm_name="Virtual Target Manager"

## Do not modify the followings (Make desktop menu)
slppath=`grep SLP_SDK_INSTALL_PATH ~/.slpsdk`
SLP_SDK_INSTALL_PATH=`echo $slppath | cut -f2- -d"="`
if [ -z $SLP_SDK_INSTALL_PATH ]
then
#   echo "There is no SLP_SDK_PATH ENV" >> /tmp/emulator.log
   exit 2;
fi

iconpath=~/.local/share/icons

emul_exepath=$SLP_SDK_INSTALL_PATH/$emul_exefile
vtm_exepath=$SLP_SDK_INSTALL_PATH/$vtm_exefile

categoryfile=~/.local/share/desktop-directories/samsung-sdk_menu.directory

mkdir -p $iconpath

cp -f $SLP_SDK_INSTALL_PATH/temp/$emul_iconfile $iconpath/$emul_iconfile
cp -f $SLP_SDK_INSTALL_PATH/temp/$vtm_iconfile $iconpath/$vtm_iconfile

mkdir -p $desktoppath

## Create emulator .desktop file 
cat > $emul_desktopfile << END
[Desktop Entry]
Encoding=UTF-8
Value=1.0
Type=Application
Terminal=false
Comment=$emul_comment
Name=$emul_name
Categories=$categories
StartupNotify=true
NoDisplay=false
END

cat >> $emul_desktopfile << END
Icon=$iconpath/$emul_iconfile
Exec=$emul_exepath
END

## Create vtm .desktop file 
cat > $vtm_desktopfile << END
[Desktop Entry]
Encoding=UTF-8
Value=1.0
Type=Application
Terminal=false
Comment=$vtm_comment
Name=$vtm_name
Categories=$categories
StartupNotify=true
NoDisplay=false
END

cat >> $vtm_desktopfile << END
Icon=$iconpath/$vtm_iconfile
Exec=$vtm_exepath
END

## Register .desktop file
xdg-desktop-menu install $categoryfile $emul_desktopfile
xdg-desktop-menu install $categoryfile $vtm_desktopfile
### END Register Menu ###
